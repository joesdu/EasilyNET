name: "CodeQL (custom dotnet build)"

on:
  push:
    branches: [ main ]
  pull_request:
    # 可按需调整
    branches: [ main ]

jobs:
  codeql-analysis:
    runs-on: ubuntu-latest
    permissions:
      actions: read
      contents: read
      security-events: write

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Initialize CodeQL
      uses: github/codeql-action/init@v3
      with:
        languages: csharp
        queries: security-extended,security-and-quality
        build-mode: manual

    - name: Setup .NET SDK
      uses: actions/setup-dotnet@v5
      with:
        dotnet-version: |
          8.0.x
          9.0.x
          10.0.x

    - name: Restore NuGet packages
      run: dotnet restore ./EasilyNET.slnx --configfile nuget.config
      # 如果仓库没有 solution 文件，请改为对 src/*.csproj 的 restore，或指定正确路径

    - name: Build solution (explicit)
      run: dotnet build ./EasilyNET.slnx --configuration Release --no-restore
      # 若没有 EasilyNET.sln，替换为根目录下的具体 .csproj 或多个 build 命令

    - name: Run CodeQL analysis
      uses: github/codeql-action/analyze@v3
      # 增加并发/超时等配置可根据需要补充
